<header>
  <h2> Posts </h2>
</header>

<% for (var i in posts) { %>
  <article>
     <header>
        <h3>
          <a href='/posts/<%= posts[i].id %>' class='titlelink'> <%= posts[i].title %> </a>
        </h3>
        <em> <%= posts[i].author && posts[i].author.name || "Sin autor" %> </em>
     </header>
     
     <p>
        <%= posts[i].body.slice(0,300) %> ... 
     </p>

     <footer>

      Comentarios: 
      
      <% var numComments = 0; %>
      <% for (var j in comments) { %>
        <% if (comments[j].postId == posts[i].id) { %>
            <% numComments++; %>
        <% } %>
      <% } %>

      <%= numComments %>

      <% if (session.user && session.user.id == posts[i].authorId) {%>

        <form id='my_form' method='post' action='/posts/<%= posts[i].id %>'>
          <input type='hidden' name='_method' value='delete'>
          <a href="/posts/<%= posts[i].id %>/edit"> Editar </a> 
          <a href='' onclick="document.getElementById('my_form').submit();return false"> Borrar </a>  
        </form>

      <% } %>

      <% if (session.user) { %>
        <% for (var k in favorites) { %>
          <% if (favorites[k].postId == posts[i].postId) { %>
            <form method='post' action='/users/<%= session.user.id %>/favourites/<%= post.id %>'>
              <input type='hidden' name='_method' value='delete'>
              <input name="commit" type="submit" value="Favorito-quitar" />
            </form>
          <% } else { %>
            <form method='post' action='/users/<%= session.user.id %>/favourites/<%= post.id %>'>
              <input type='hidden' name='_method' value='put'>
              <input name="commit" type="submit" value="Favorito-aÃ±adir" />
            </form>
          <% } %>
        <% } %>
      <% } %>

     </footer>
  </article>

<%  }; %>
<footer>
  <nav>
    <a href="/posts/new"> Crear nuevo Post </a>
  </nav>
</footer>
